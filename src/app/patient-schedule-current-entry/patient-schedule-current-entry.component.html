<div class="elems-container flex rounded-2xl shadow-xl m-2 p-2">

  <div class="flex flex-col gap-5 w-1/2">
    <div class="cont-elevation flex gap-7 items-center py-4 px-5 cursor-pointer" (click)="navigateToPatientDetails()">
      <mat-icon class="icon-display" style="transform: scale(2);">account_circle</mat-icon>
      <p>{{appointment.patient.firstName}} {{appointment.patient.lastName}}</p> 
    </div>
    <div [class.visible-tgl]="!panelOpenState">Reason for Visit:  &nbsp; &nbsp;{{appointment.reasonForVisit}}</div>
  </div>
    

  <div class="spacer grow-[2]"></div>

  <div class="actions_nd_stats flex justify-end  w-1/2 gap-2">
      <!-- <mat-accordion> -->

        <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false"
          style="border-radius: 0.7rem;">
          <!-- --------------------------- Flags & Main Actions -------------------------- -->
          <mat-expansion-panel-header class="specific-class">
            @if (appointment != null && appointment.isUrgent) {
              <img src="assets/images/alarm.gif" alt="Emergency" class="object-containss">
            }

            <div class="flex justify-center items-center gap-2">
              @if (appointment != null && appointment.patientInClinic) {
                <mat-icon class="icon-btn">where_to_vote</mat-icon>
              }
              @if (appointment != null && appointment.paid) {
                <mat-icon class="icon-btn mr-3">paid</mat-icon>
              }
            </div>
            
          </mat-expansion-panel-header>
          <!-- --------------------------- Actions -------------------------- -->
          <div class="flex gap-2 border-t-2 border-r-blue-300 pt-4">
            <button mat-mini-fab aria-label="Call Patient"
              class="rounded-full flex items-center justify-center p-1 shadow-md  bg-[#03a9f466] hover:bg-[#35BEFD]">
              <mat-icon>call</mat-icon>
            </button>
            <button
              mat-mini-fab aria-label="Send SMS to Patient" class="rounded-full flex items-center justify-center p-1 shadow-md  bg-[#03a9f466] hover:bg-[#35BEFD]">
              <mat-icon>sms</mat-icon>
            </button>
            <button mat-mini-fab aria-label="Patient on site toggle" (click)="toggleOnSite()"
              class="rounded-full flex items-center justify-center p-1 shadow-md  bg-[#03a9f466] hover:bg-[#35BEFD]"
              [disabled]="updateOnSiteIsInProgress">
              <mat-icon>where_to_vote</mat-icon>
            </button>
            <button mat-mini-fab aria-label="Patient paid on site"  (click)="togglePaid()"
              class="rounded-full flex items-center justify-center p-1 shadow-md  bg-[#03a9f466] hover:bg-[#35BEFD]"
              [disabled]="updatePaidIsInProgress">
              <mat-icon>paid</mat-icon>
            </button>
            <button mat-mini-fab aria-label="Patient paid on site" (click)="toggleUrgent()"
              class="rounded-full flex items-center justify-center p-1 shadow-md  bg-[#03a9f466] hover:bg-[#35BEFD]"
              [disabled]="updateUrgencyInProgress">
              <mat-icon>emergency</mat-icon>
            </button>
          </div>
        </mat-expansion-panel>
      <!-- </mat-accordion> -->
      <div class="pl-6">


        @switch (appointment.state.toLowerCase()) {
          @case ('waiting') {
            <button mat-fab color="primary" 
              aria-label="Patient is waiting to enter for examinationg"
              (click)="setStateToExamining()"
              class="scale-down-on-small" [disabled]="updateAppointmentState">
              <mat-icon>login</mat-icon>
            </button>
          }
          @case ('examining') {
            <button mat-fab color="primary" aria-label="Patient exited and done examination" (click)="setStateToDone()"
            [disabled]="updateAppointmentState">
              <mat-icon>logout</mat-icon>
            </button>
          }
          @default {
            
          }
        }

        
      </div>



  </div>
</div>